


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: FeedItemAnimator</title>
  <style type="text/css">
    @import "../../css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">org.wikipedia.feed.view</a> ]
</div>

<h1>Coverage Summary for Class: FeedItemAnimator (org.wikipedia.feed.view)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">FeedItemAnimator</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 21)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 298)
  </span>
</td>
</tr>
  <tr>
    <td class="name">FeedItemAnimator$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FeedItemAnimator$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FeedItemAnimator$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FeedItemAnimator$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FeedItemAnimator$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FeedItemAnimator$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 10)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FeedItemAnimator$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FeedItemAnimator$8</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FeedItemAnimator$ChangeInfo</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FeedItemAnimator$MoveInfo</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 6)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 48)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 373)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;package org.wikipedia.feed.view;
<i>2</i>&nbsp;
<i>3</i>&nbsp;import android.animation.Animator;
<i>4</i>&nbsp;import android.animation.AnimatorListenerAdapter;
<i>5</i>&nbsp;import android.animation.TimeInterpolator;
<i>6</i>&nbsp;import android.animation.ValueAnimator;
<i>7</i>&nbsp;import android.support.annotation.NonNull;
<i>8</i>&nbsp;import android.support.v4.view.ViewCompat;
<i>9</i>&nbsp;import android.support.v7.widget.RecyclerView.ViewHolder;
<i>10</i>&nbsp;import android.support.v7.widget.SimpleItemAnimator;
<i>11</i>&nbsp;import android.view.View;
<i>12</i>&nbsp;import android.view.ViewPropertyAnimator;
<i>13</i>&nbsp;
<i>14</i>&nbsp;import org.wikipedia.feed.progress.ProgressCardView;
<i>15</i>&nbsp;import org.wikipedia.util.DimenUtil;
<i>16</i>&nbsp;
<i>17</i>&nbsp;import java.util.ArrayList;
<i>18</i>&nbsp;import java.util.List;
<i>19</i>&nbsp;
<i>20</i>&nbsp;/**
<i>21</i>&nbsp; * Lifted nearly entirely from android.support.v7.widget.DefaultItemAnimator, with a few
<i>22</i>&nbsp; * key modifications and updates.
<i>23</i>&nbsp; * Dmitry Brant, 2018
<i>24</i>&nbsp; */
<b class="nc"><i>25</i>&nbsp;public class FeedItemAnimator extends SimpleItemAnimator {</b>
<i>26</i>&nbsp;    private static final boolean DEBUG = false;
<i>27</i>&nbsp;    private static TimeInterpolator DEFAULT_INTERPOLATOR;
<i>28</i>&nbsp;
<b class="nc"><i>29</i>&nbsp;    private ArrayList&lt;ViewHolder&gt; mPendingRemovals = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>30</i>&nbsp;    private ArrayList&lt;ViewHolder&gt; mPendingAdditions = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>31</i>&nbsp;    private ArrayList&lt;MoveInfo&gt; mPendingMoves = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>32</i>&nbsp;    private ArrayList&lt;ChangeInfo&gt; mPendingChanges = new ArrayList&lt;&gt;();</b>
<i>33</i>&nbsp;
<b class="nc"><i>34</i>&nbsp;    private ArrayList&lt;ArrayList&lt;ViewHolder&gt;&gt; mAdditionsList = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>35</i>&nbsp;    private ArrayList&lt;ArrayList&lt;MoveInfo&gt;&gt; mMovesList = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>36</i>&nbsp;    private ArrayList&lt;ArrayList&lt;ChangeInfo&gt;&gt; mChangesList = new ArrayList&lt;&gt;();</b>
<i>37</i>&nbsp;
<b class="nc"><i>38</i>&nbsp;    private ArrayList&lt;ViewHolder&gt; mAddAnimations = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>39</i>&nbsp;    private ArrayList&lt;ViewHolder&gt; mMoveAnimations = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>40</i>&nbsp;    private ArrayList&lt;ViewHolder&gt; mRemoveAnimations = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>41</i>&nbsp;    private ArrayList&lt;ViewHolder&gt; mChangeAnimations = new ArrayList&lt;&gt;();</b>
<i>42</i>&nbsp;
<i>43</i>&nbsp;    private static class MoveInfo {
<i>44</i>&nbsp;        ViewHolder holder;
<i>45</i>&nbsp;        int fromX, fromY, toX, toY;
<i>46</i>&nbsp;
<b class="nc"><i>47</i>&nbsp;        MoveInfo(ViewHolder holder, int fromX, int fromY, int toX, int toY) {</b>
<b class="nc"><i>48</i>&nbsp;            this.holder = holder;</b>
<b class="nc"><i>49</i>&nbsp;            this.fromX = fromX;</b>
<b class="nc"><i>50</i>&nbsp;            this.fromY = fromY;</b>
<b class="nc"><i>51</i>&nbsp;            this.toX = toX;</b>
<b class="nc"><i>52</i>&nbsp;            this.toY = toY;</b>
<i>53</i>&nbsp;        }
<i>54</i>&nbsp;    }
<i>55</i>&nbsp;
<i>56</i>&nbsp;    private static class ChangeInfo {
<i>57</i>&nbsp;        ViewHolder oldHolder, newHolder;
<i>58</i>&nbsp;        int fromX, fromY, toX, toY;
<b class="nc"><i>59</i>&nbsp;        private ChangeInfo(ViewHolder oldHolder, ViewHolder newHolder) {</b>
<b class="nc"><i>60</i>&nbsp;            this.oldHolder = oldHolder;</b>
<b class="nc"><i>61</i>&nbsp;            this.newHolder = newHolder;</b>
<i>62</i>&nbsp;        }
<i>63</i>&nbsp;
<i>64</i>&nbsp;        ChangeInfo(ViewHolder oldHolder, ViewHolder newHolder,
<i>65</i>&nbsp;                   int fromX, int fromY, int toX, int toY) {
<b class="nc"><i>66</i>&nbsp;            this(oldHolder, newHolder);</b>
<b class="nc"><i>67</i>&nbsp;            this.fromX = fromX;</b>
<b class="nc"><i>68</i>&nbsp;            this.fromY = fromY;</b>
<b class="nc"><i>69</i>&nbsp;            this.toX = toX;</b>
<b class="nc"><i>70</i>&nbsp;            this.toY = toY;</b>
<i>71</i>&nbsp;        }
<i>72</i>&nbsp;
<i>73</i>&nbsp;        @Override
<i>74</i>&nbsp;        public String toString() {
<b class="nc"><i>75</i>&nbsp;            return &quot;ChangeInfo{&quot;</b>
<i>76</i>&nbsp;                    + &quot;oldHolder=&quot; + oldHolder
<i>77</i>&nbsp;                    + &quot;, newHolder=&quot; + newHolder
<i>78</i>&nbsp;                    + &quot;, fromX=&quot; + fromX
<i>79</i>&nbsp;                    + &quot;, fromY=&quot; + fromY
<i>80</i>&nbsp;                    + &quot;, toX=&quot; + toX
<i>81</i>&nbsp;                    + &quot;, toY=&quot; + toY
<i>82</i>&nbsp;                    + &#39;}&#39;;
<i>83</i>&nbsp;        }
<i>84</i>&nbsp;    }
<i>85</i>&nbsp;
<i>86</i>&nbsp;    @Override
<i>87</i>&nbsp;    public void runPendingAnimations() {
<b class="nc"><i>88</i>&nbsp;        boolean removalsPending = !mPendingRemovals.isEmpty();</b>
<b class="nc"><i>89</i>&nbsp;        boolean movesPending = !mPendingMoves.isEmpty();</b>
<b class="nc"><i>90</i>&nbsp;        boolean changesPending = !mPendingChanges.isEmpty();</b>
<b class="nc"><i>91</i>&nbsp;        boolean additionsPending = !mPendingAdditions.isEmpty();</b>
<b class="nc"><i>92</i>&nbsp;        if (!removalsPending &amp;&amp; !movesPending &amp;&amp; !additionsPending &amp;&amp; !changesPending) {</b>
<i>93</i>&nbsp;            // nothing to animate
<i>94</i>&nbsp;            return;
<i>95</i>&nbsp;        }
<i>96</i>&nbsp;        // First, remove stuff
<b class="nc"><i>97</i>&nbsp;        for (ViewHolder holder : mPendingRemovals) {</b>
<b class="nc"><i>98</i>&nbsp;            animateRemoveImpl(holder);</b>
<b class="nc"><i>99</i>&nbsp;        }</b>
<b class="nc"><i>100</i>&nbsp;        mPendingRemovals.clear();</b>
<i>101</i>&nbsp;        // Next, move stuff
<b class="nc"><i>102</i>&nbsp;        if (movesPending) {</b>
<b class="nc"><i>103</i>&nbsp;            final ArrayList&lt;MoveInfo&gt; moves = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>104</i>&nbsp;            moves.addAll(mPendingMoves);</b>
<b class="nc"><i>105</i>&nbsp;            mMovesList.add(moves);</b>
<b class="nc"><i>106</i>&nbsp;            mPendingMoves.clear();</b>
<b class="nc"><i>107</i>&nbsp;            Runnable mover = new Runnable() {</b>
<i>108</i>&nbsp;                @Override
<i>109</i>&nbsp;                public void run() {
<b class="nc"><i>110</i>&nbsp;                    for (MoveInfo moveInfo : moves) {</b>
<b class="nc"><i>111</i>&nbsp;                        animateMoveImpl(moveInfo.holder, moveInfo.fromX, moveInfo.fromY,</b>
<i>112</i>&nbsp;                                moveInfo.toX, moveInfo.toY);
<b class="nc"><i>113</i>&nbsp;                    }</b>
<b class="nc"><i>114</i>&nbsp;                    moves.clear();</b>
<b class="nc"><i>115</i>&nbsp;                    mMovesList.remove(moves);</b>
<i>116</i>&nbsp;                }
<i>117</i>&nbsp;            };
<b class="nc"><i>118</i>&nbsp;            if (removalsPending) {</b>
<b class="nc"><i>119</i>&nbsp;                View view = moves.get(0).holder.itemView;</b>
<b class="nc"><i>120</i>&nbsp;                ViewCompat.postOnAnimationDelayed(view, mover, getRemoveDuration());</b>
<b class="nc"><i>121</i>&nbsp;            } else {</b>
<b class="nc"><i>122</i>&nbsp;                mover.run();</b>
<i>123</i>&nbsp;            }
<i>124</i>&nbsp;        }
<i>125</i>&nbsp;        // Next, change stuff, to run in parallel with move animations
<b class="nc"><i>126</i>&nbsp;        if (changesPending) {</b>
<b class="nc"><i>127</i>&nbsp;            final ArrayList&lt;ChangeInfo&gt; changes = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>128</i>&nbsp;            changes.addAll(mPendingChanges);</b>
<b class="nc"><i>129</i>&nbsp;            mChangesList.add(changes);</b>
<b class="nc"><i>130</i>&nbsp;            mPendingChanges.clear();</b>
<b class="nc"><i>131</i>&nbsp;            Runnable changer = new Runnable() {</b>
<i>132</i>&nbsp;                @Override
<i>133</i>&nbsp;                public void run() {
<b class="nc"><i>134</i>&nbsp;                    for (ChangeInfo change : changes) {</b>
<b class="nc"><i>135</i>&nbsp;                        animateChangeImpl(change);</b>
<b class="nc"><i>136</i>&nbsp;                    }</b>
<b class="nc"><i>137</i>&nbsp;                    changes.clear();</b>
<b class="nc"><i>138</i>&nbsp;                    mChangesList.remove(changes);</b>
<i>139</i>&nbsp;                }
<i>140</i>&nbsp;            };
<b class="nc"><i>141</i>&nbsp;            if (removalsPending) {</b>
<b class="nc"><i>142</i>&nbsp;                ViewHolder holder = changes.get(0).oldHolder;</b>
<b class="nc"><i>143</i>&nbsp;                ViewCompat.postOnAnimationDelayed(holder.itemView, changer, getRemoveDuration());</b>
<b class="nc"><i>144</i>&nbsp;            } else {</b>
<b class="nc"><i>145</i>&nbsp;                changer.run();</b>
<i>146</i>&nbsp;            }
<i>147</i>&nbsp;        }
<i>148</i>&nbsp;        // Next, add stuff
<b class="nc"><i>149</i>&nbsp;        if (additionsPending) {</b>
<b class="nc"><i>150</i>&nbsp;            final ArrayList&lt;ViewHolder&gt; additions = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>151</i>&nbsp;            additions.addAll(mPendingAdditions);</b>
<b class="nc"><i>152</i>&nbsp;            mAdditionsList.add(additions);</b>
<b class="nc"><i>153</i>&nbsp;            mPendingAdditions.clear();</b>
<b class="nc"><i>154</i>&nbsp;            Runnable adder = new Runnable() {</b>
<i>155</i>&nbsp;                @Override
<i>156</i>&nbsp;                public void run() {
<b class="nc"><i>157</i>&nbsp;                    for (ViewHolder holder : additions) {</b>
<b class="nc"><i>158</i>&nbsp;                        animateAddImpl(holder);</b>
<b class="nc"><i>159</i>&nbsp;                    }</b>
<b class="nc"><i>160</i>&nbsp;                    additions.clear();</b>
<b class="nc"><i>161</i>&nbsp;                    mAdditionsList.remove(additions);</b>
<i>162</i>&nbsp;                }
<i>163</i>&nbsp;            };
<b class="nc"><i>164</i>&nbsp;            if (removalsPending || movesPending || changesPending) {</b>
<b class="nc"><i>165</i>&nbsp;                long removeDuration = removalsPending ? getRemoveDuration() : 0;</b>
<b class="nc"><i>166</i>&nbsp;                long moveDuration = movesPending ? getMoveDuration() : 0;</b>
<b class="nc"><i>167</i>&nbsp;                long changeDuration = changesPending ? getChangeDuration() : 0;</b>
<b class="nc"><i>168</i>&nbsp;                long totalDelay = removeDuration + Math.max(moveDuration, changeDuration);</b>
<b class="nc"><i>169</i>&nbsp;                View view = additions.get(0).itemView;</b>
<b class="nc"><i>170</i>&nbsp;                ViewCompat.postOnAnimationDelayed(view, adder, totalDelay);</b>
<b class="nc"><i>171</i>&nbsp;            } else {</b>
<b class="nc"><i>172</i>&nbsp;                adder.run();</b>
<i>173</i>&nbsp;            }
<i>174</i>&nbsp;        }
<i>175</i>&nbsp;    }
<i>176</i>&nbsp;
<i>177</i>&nbsp;    @Override
<i>178</i>&nbsp;    public boolean animateRemove(final ViewHolder holder) {
<b class="nc"><i>179</i>&nbsp;        resetAnimation(holder);</b>
<b class="nc"><i>180</i>&nbsp;        mPendingRemovals.add(holder);</b>
<b class="nc"><i>181</i>&nbsp;        return true;</b>
<i>182</i>&nbsp;    }
<i>183</i>&nbsp;
<i>184</i>&nbsp;    private void animateRemoveImpl(final ViewHolder holder) {
<b class="nc"><i>185</i>&nbsp;        final View view = holder.itemView;</b>
<b class="nc"><i>186</i>&nbsp;        final ViewPropertyAnimator animation = view.animate();</b>
<b class="nc"><i>187</i>&nbsp;        mRemoveAnimations.add(holder);</b>
<b class="nc"><i>188</i>&nbsp;        animation.setDuration(getRemoveDuration()).alpha(0).setListener(</b>
<b class="nc"><i>189</i>&nbsp;                new AnimatorListenerAdapter() {</b>
<i>190</i>&nbsp;                    @Override
<i>191</i>&nbsp;                    public void onAnimationStart(Animator animator) {
<b class="nc"><i>192</i>&nbsp;                        dispatchRemoveStarting(holder);</b>
<i>193</i>&nbsp;                    }
<i>194</i>&nbsp;
<i>195</i>&nbsp;                    @Override
<i>196</i>&nbsp;                    public void onAnimationEnd(Animator animator) {
<b class="nc"><i>197</i>&nbsp;                        animation.setListener(null);</b>
<b class="nc"><i>198</i>&nbsp;                        view.setAlpha(1);</b>
<b class="nc"><i>199</i>&nbsp;                        dispatchRemoveFinished(holder);</b>
<b class="nc"><i>200</i>&nbsp;                        mRemoveAnimations.remove(holder);</b>
<b class="nc"><i>201</i>&nbsp;                        dispatchFinishedWhenDone();</b>
<i>202</i>&nbsp;                    }
<b class="nc"><i>203</i>&nbsp;                }).start();</b>
<i>204</i>&nbsp;    }
<i>205</i>&nbsp;
<i>206</i>&nbsp;    @Override
<i>207</i>&nbsp;    public boolean animateAdd(final ViewHolder holder) {
<b class="nc"><i>208</i>&nbsp;        resetAnimation(holder);</b>
<b class="nc"><i>209</i>&nbsp;        holder.itemView.setAlpha(0);</b>
<b class="nc"><i>210</i>&nbsp;        final float translationStart = 48f;</b>
<b class="nc"><i>211</i>&nbsp;        holder.itemView.setTranslationY(translationStart * DimenUtil.getDensityScalar());</b>
<b class="nc"><i>212</i>&nbsp;        mPendingAdditions.add(holder);</b>
<b class="nc"><i>213</i>&nbsp;        return true;</b>
<i>214</i>&nbsp;    }
<i>215</i>&nbsp;
<i>216</i>&nbsp;    private void animateAddImpl(final ViewHolder holder) {
<b class="nc"><i>217</i>&nbsp;        final View view = holder.itemView;</b>
<b class="nc"><i>218</i>&nbsp;        if (view instanceof ProgressCardView) {</b>
<b class="nc"><i>219</i>&nbsp;            view.setAlpha(1);</b>
<b class="nc"><i>220</i>&nbsp;            view.setTranslationY(0);</b>
<b class="nc"><i>221</i>&nbsp;            dispatchAddFinished(holder);</b>
<b class="nc"><i>222</i>&nbsp;            mAddAnimations.remove(holder);</b>
<i>223</i>&nbsp;            return;
<i>224</i>&nbsp;        }
<b class="nc"><i>225</i>&nbsp;        final ViewPropertyAnimator animation = view.animate();</b>
<b class="nc"><i>226</i>&nbsp;        mAddAnimations.add(holder);</b>
<b class="nc"><i>227</i>&nbsp;        animation.alpha(1).translationY(0).setDuration(getAddDuration())</b>
<b class="nc"><i>228</i>&nbsp;                .setListener(new AnimatorListenerAdapter() {</b>
<i>229</i>&nbsp;                    @Override
<i>230</i>&nbsp;                    public void onAnimationStart(Animator animator) {
<b class="nc"><i>231</i>&nbsp;                        dispatchAddStarting(holder);</b>
<i>232</i>&nbsp;                    }
<i>233</i>&nbsp;
<i>234</i>&nbsp;                    @Override
<i>235</i>&nbsp;                    public void onAnimationCancel(Animator animator) {
<b class="nc"><i>236</i>&nbsp;                        view.setTranslationY(0);</b>
<i>237</i>&nbsp;                    }
<i>238</i>&nbsp;
<i>239</i>&nbsp;                    @Override
<i>240</i>&nbsp;                    public void onAnimationEnd(Animator animator) {
<b class="nc"><i>241</i>&nbsp;                        animation.setListener(null);</b>
<b class="nc"><i>242</i>&nbsp;                        dispatchAddFinished(holder);</b>
<b class="nc"><i>243</i>&nbsp;                        mAddAnimations.remove(holder);</b>
<b class="nc"><i>244</i>&nbsp;                        dispatchFinishedWhenDone();</b>
<i>245</i>&nbsp;                    }
<b class="nc"><i>246</i>&nbsp;                }).start();</b>
<i>247</i>&nbsp;    }
<i>248</i>&nbsp;
<i>249</i>&nbsp;    @Override
<i>250</i>&nbsp;    public boolean animateMove(final ViewHolder holder, int fromX, int fromY,
<i>251</i>&nbsp;                               int toX, int toY) {
<b class="nc"><i>252</i>&nbsp;        final View view = holder.itemView;</b>
<b class="nc"><i>253</i>&nbsp;        fromX += (int) holder.itemView.getTranslationX();</b>
<b class="nc"><i>254</i>&nbsp;        fromY += (int) holder.itemView.getTranslationY();</b>
<b class="nc"><i>255</i>&nbsp;        resetAnimation(holder);</b>
<b class="nc"><i>256</i>&nbsp;        int deltaX = toX - fromX;</b>
<b class="nc"><i>257</i>&nbsp;        int deltaY = toY - fromY;</b>
<b class="nc"><i>258</i>&nbsp;        if (deltaX == 0 &amp;&amp; deltaY == 0) {</b>
<b class="nc"><i>259</i>&nbsp;            dispatchMoveFinished(holder);</b>
<b class="nc"><i>260</i>&nbsp;            return false;</b>
<i>261</i>&nbsp;        }
<b class="nc"><i>262</i>&nbsp;        if (deltaX != 0) {</b>
<b class="nc"><i>263</i>&nbsp;            view.setTranslationX(-deltaX);</b>
<i>264</i>&nbsp;        }
<b class="nc"><i>265</i>&nbsp;        if (deltaY != 0) {</b>
<b class="nc"><i>266</i>&nbsp;            view.setTranslationY(-deltaY);</b>
<i>267</i>&nbsp;        }
<b class="nc"><i>268</i>&nbsp;        mPendingMoves.add(new MoveInfo(holder, fromX, fromY, toX, toY));</b>
<b class="nc"><i>269</i>&nbsp;        return true;</b>
<i>270</i>&nbsp;    }
<i>271</i>&nbsp;
<i>272</i>&nbsp;    void animateMoveImpl(final ViewHolder holder, int fromX, int fromY, int toX, int toY) {
<b class="nc"><i>273</i>&nbsp;        final View view = holder.itemView;</b>
<b class="nc"><i>274</i>&nbsp;        final int deltaX = toX - fromX;</b>
<b class="nc"><i>275</i>&nbsp;        final int deltaY = toY - fromY;</b>
<b class="nc"><i>276</i>&nbsp;        if (deltaX != 0) {</b>
<b class="nc"><i>277</i>&nbsp;            view.animate().translationX(0);</b>
<i>278</i>&nbsp;        }
<b class="nc"><i>279</i>&nbsp;        if (deltaY != 0) {</b>
<b class="nc"><i>280</i>&nbsp;            view.animate().translationY(0);</b>
<i>281</i>&nbsp;        }
<i>282</i>&nbsp;        // TODO: make EndActions end listeners instead, since end actions aren&#39;t called when
<i>283</i>&nbsp;        // vpas are canceled (and can&#39;t end them. why?)
<i>284</i>&nbsp;        // need listener functionality in VPACompat for this. Ick.
<b class="nc"><i>285</i>&nbsp;        final ViewPropertyAnimator animation = view.animate();</b>
<b class="nc"><i>286</i>&nbsp;        mMoveAnimations.add(holder);</b>
<b class="nc"><i>287</i>&nbsp;        animation.setDuration(getMoveDuration()).setListener(new AnimatorListenerAdapter() {</b>
<i>288</i>&nbsp;            @Override
<i>289</i>&nbsp;            public void onAnimationStart(Animator animator) {
<b class="nc"><i>290</i>&nbsp;                dispatchMoveStarting(holder);</b>
<i>291</i>&nbsp;            }
<i>292</i>&nbsp;
<i>293</i>&nbsp;            @Override
<i>294</i>&nbsp;            public void onAnimationCancel(Animator animator) {
<b class="nc"><i>295</i>&nbsp;                if (deltaX != 0) {</b>
<b class="nc"><i>296</i>&nbsp;                    view.setTranslationX(0);</b>
<i>297</i>&nbsp;                }
<b class="nc"><i>298</i>&nbsp;                if (deltaY != 0) {</b>
<b class="nc"><i>299</i>&nbsp;                    view.setTranslationY(0);</b>
<i>300</i>&nbsp;                }
<i>301</i>&nbsp;            }
<i>302</i>&nbsp;
<i>303</i>&nbsp;            @Override
<i>304</i>&nbsp;            public void onAnimationEnd(Animator animator) {
<b class="nc"><i>305</i>&nbsp;                animation.setListener(null);</b>
<b class="nc"><i>306</i>&nbsp;                dispatchMoveFinished(holder);</b>
<b class="nc"><i>307</i>&nbsp;                mMoveAnimations.remove(holder);</b>
<b class="nc"><i>308</i>&nbsp;                dispatchFinishedWhenDone();</b>
<i>309</i>&nbsp;            }
<b class="nc"><i>310</i>&nbsp;        }).start();</b>
<i>311</i>&nbsp;    }
<i>312</i>&nbsp;
<i>313</i>&nbsp;    @Override
<i>314</i>&nbsp;    public boolean animateChange(ViewHolder oldHolder, ViewHolder newHolder,
<i>315</i>&nbsp;                                 int fromX, int fromY, int toX, int toY) {
<b class="nc"><i>316</i>&nbsp;        if (oldHolder == newHolder) {</b>
<i>317</i>&nbsp;            // Don&#39;t know how to run change animations when the same view holder is re-used.
<i>318</i>&nbsp;            // run a move animation to handle position changes.
<b class="nc"><i>319</i>&nbsp;            return animateMove(oldHolder, fromX, fromY, toX, toY);</b>
<i>320</i>&nbsp;        }
<b class="nc"><i>321</i>&nbsp;        final float prevTranslationX = oldHolder.itemView.getTranslationX();</b>
<b class="nc"><i>322</i>&nbsp;        final float prevTranslationY = oldHolder.itemView.getTranslationY();</b>
<b class="nc"><i>323</i>&nbsp;        final float prevAlpha = oldHolder.itemView.getAlpha();</b>
<b class="nc"><i>324</i>&nbsp;        resetAnimation(oldHolder);</b>
<b class="nc"><i>325</i>&nbsp;        int deltaX = (int) (toX - fromX - prevTranslationX);</b>
<b class="nc"><i>326</i>&nbsp;        int deltaY = (int) (toY - fromY - prevTranslationY);</b>
<i>327</i>&nbsp;        // recover prev translation state after ending animation
<b class="nc"><i>328</i>&nbsp;        oldHolder.itemView.setTranslationX(prevTranslationX);</b>
<b class="nc"><i>329</i>&nbsp;        oldHolder.itemView.setTranslationY(prevTranslationY);</b>
<b class="nc"><i>330</i>&nbsp;        oldHolder.itemView.setAlpha(prevAlpha);</b>
<b class="nc"><i>331</i>&nbsp;        if (newHolder != null) {</b>
<i>332</i>&nbsp;            // carry over translation values
<b class="nc"><i>333</i>&nbsp;            resetAnimation(newHolder);</b>
<b class="nc"><i>334</i>&nbsp;            newHolder.itemView.setTranslationX(-deltaX);</b>
<b class="nc"><i>335</i>&nbsp;            newHolder.itemView.setTranslationY(-deltaY);</b>
<b class="nc"><i>336</i>&nbsp;            newHolder.itemView.setAlpha(0);</b>
<i>337</i>&nbsp;        }
<b class="nc"><i>338</i>&nbsp;        mPendingChanges.add(new ChangeInfo(oldHolder, newHolder, fromX, fromY, toX, toY));</b>
<b class="nc"><i>339</i>&nbsp;        return true;</b>
<i>340</i>&nbsp;    }
<i>341</i>&nbsp;
<i>342</i>&nbsp;    void animateChangeImpl(final ChangeInfo changeInfo) {
<b class="nc"><i>343</i>&nbsp;        final ViewHolder holder = changeInfo.oldHolder;</b>
<b class="nc"><i>344</i>&nbsp;        final View view = holder == null ? null : holder.itemView;</b>
<b class="nc"><i>345</i>&nbsp;        final ViewHolder newHolder = changeInfo.newHolder;</b>
<b class="nc"><i>346</i>&nbsp;        final View newView = newHolder != null ? newHolder.itemView : null;</b>
<b class="nc"><i>347</i>&nbsp;        if (view != null) {</b>
<b class="nc"><i>348</i>&nbsp;            final ViewPropertyAnimator oldViewAnim = view.animate().setDuration(</b>
<b class="nc"><i>349</i>&nbsp;                    getChangeDuration());</b>
<b class="nc"><i>350</i>&nbsp;            mChangeAnimations.add(changeInfo.oldHolder);</b>
<b class="nc"><i>351</i>&nbsp;            oldViewAnim.translationX(changeInfo.toX - changeInfo.fromX);</b>
<b class="nc"><i>352</i>&nbsp;            oldViewAnim.translationY(changeInfo.toY - changeInfo.fromY);</b>
<b class="nc"><i>353</i>&nbsp;            oldViewAnim.alpha(0).setListener(new AnimatorListenerAdapter() {</b>
<i>354</i>&nbsp;                @Override
<i>355</i>&nbsp;                public void onAnimationStart(Animator animator) {
<b class="nc"><i>356</i>&nbsp;                    dispatchChangeStarting(changeInfo.oldHolder, true);</b>
<i>357</i>&nbsp;                }
<i>358</i>&nbsp;
<i>359</i>&nbsp;                @Override
<i>360</i>&nbsp;                public void onAnimationEnd(Animator animator) {
<b class="nc"><i>361</i>&nbsp;                    oldViewAnim.setListener(null);</b>
<b class="nc"><i>362</i>&nbsp;                    view.setAlpha(1);</b>
<b class="nc"><i>363</i>&nbsp;                    view.setTranslationX(0);</b>
<b class="nc"><i>364</i>&nbsp;                    view.setTranslationY(0);</b>
<b class="nc"><i>365</i>&nbsp;                    dispatchChangeFinished(changeInfo.oldHolder, true);</b>
<b class="nc"><i>366</i>&nbsp;                    mChangeAnimations.remove(changeInfo.oldHolder);</b>
<b class="nc"><i>367</i>&nbsp;                    dispatchFinishedWhenDone();</b>
<i>368</i>&nbsp;                }
<b class="nc"><i>369</i>&nbsp;            }).start();</b>
<i>370</i>&nbsp;        }
<b class="nc"><i>371</i>&nbsp;        if (newView != null) {</b>
<b class="nc"><i>372</i>&nbsp;            final ViewPropertyAnimator newViewAnimation = newView.animate();</b>
<b class="nc"><i>373</i>&nbsp;            mChangeAnimations.add(changeInfo.newHolder);</b>
<b class="nc"><i>374</i>&nbsp;            newViewAnimation.translationX(0).translationY(0).setDuration(getChangeDuration())</b>
<b class="nc"><i>375</i>&nbsp;                    .alpha(1).setListener(new AnimatorListenerAdapter() {</b>
<i>376</i>&nbsp;                @Override
<i>377</i>&nbsp;                public void onAnimationStart(Animator animator) {
<b class="nc"><i>378</i>&nbsp;                    dispatchChangeStarting(changeInfo.newHolder, false);</b>
<i>379</i>&nbsp;                }
<i>380</i>&nbsp;                @Override
<i>381</i>&nbsp;                public void onAnimationEnd(Animator animator) {
<b class="nc"><i>382</i>&nbsp;                    newViewAnimation.setListener(null);</b>
<b class="nc"><i>383</i>&nbsp;                    newView.setAlpha(1);</b>
<b class="nc"><i>384</i>&nbsp;                    newView.setTranslationX(0);</b>
<b class="nc"><i>385</i>&nbsp;                    newView.setTranslationY(0);</b>
<b class="nc"><i>386</i>&nbsp;                    dispatchChangeFinished(changeInfo.newHolder, false);</b>
<b class="nc"><i>387</i>&nbsp;                    mChangeAnimations.remove(changeInfo.newHolder);</b>
<b class="nc"><i>388</i>&nbsp;                    dispatchFinishedWhenDone();</b>
<i>389</i>&nbsp;                }
<b class="nc"><i>390</i>&nbsp;            }).start();</b>
<i>391</i>&nbsp;        }
<i>392</i>&nbsp;    }
<i>393</i>&nbsp;
<i>394</i>&nbsp;    private void endChangeAnimation(List&lt;ChangeInfo&gt; infoList, ViewHolder item) {
<b class="nc"><i>395</i>&nbsp;        for (int i = infoList.size() - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>396</i>&nbsp;            ChangeInfo changeInfo = infoList.get(i);</b>
<b class="nc"><i>397</i>&nbsp;            if (endChangeAnimationIfNecessary(changeInfo, item)) {</b>
<b class="nc"><i>398</i>&nbsp;                if (changeInfo.oldHolder == null &amp;&amp; changeInfo.newHolder == null) {</b>
<b class="nc"><i>399</i>&nbsp;                    infoList.remove(changeInfo);</b>
<i>400</i>&nbsp;                }
<i>401</i>&nbsp;            }
<i>402</i>&nbsp;        }
<i>403</i>&nbsp;    }
<i>404</i>&nbsp;
<i>405</i>&nbsp;    private void endChangeAnimationIfNecessary(ChangeInfo changeInfo) {
<b class="nc"><i>406</i>&nbsp;        if (changeInfo.oldHolder != null) {</b>
<b class="nc"><i>407</i>&nbsp;            endChangeAnimationIfNecessary(changeInfo, changeInfo.oldHolder);</b>
<i>408</i>&nbsp;        }
<b class="nc"><i>409</i>&nbsp;        if (changeInfo.newHolder != null) {</b>
<b class="nc"><i>410</i>&nbsp;            endChangeAnimationIfNecessary(changeInfo, changeInfo.newHolder);</b>
<i>411</i>&nbsp;        }
<i>412</i>&nbsp;    }
<i>413</i>&nbsp;    private boolean endChangeAnimationIfNecessary(ChangeInfo changeInfo, ViewHolder item) {
<b class="nc"><i>414</i>&nbsp;        boolean oldItem = false;</b>
<b class="nc"><i>415</i>&nbsp;        if (changeInfo.newHolder == item) {</b>
<b class="nc"><i>416</i>&nbsp;            changeInfo.newHolder = null;</b>
<b class="nc"><i>417</i>&nbsp;        } else if (changeInfo.oldHolder == item) {</b>
<b class="nc"><i>418</i>&nbsp;            changeInfo.oldHolder = null;</b>
<b class="nc"><i>419</i>&nbsp;            oldItem = true;</b>
<i>420</i>&nbsp;        } else {
<b class="nc"><i>421</i>&nbsp;            return false;</b>
<i>422</i>&nbsp;        }
<b class="nc"><i>423</i>&nbsp;        item.itemView.setAlpha(1);</b>
<b class="nc"><i>424</i>&nbsp;        item.itemView.setTranslationX(0);</b>
<b class="nc"><i>425</i>&nbsp;        item.itemView.setTranslationY(0);</b>
<b class="nc"><i>426</i>&nbsp;        dispatchChangeFinished(item, oldItem);</b>
<b class="nc"><i>427</i>&nbsp;        return true;</b>
<i>428</i>&nbsp;    }
<i>429</i>&nbsp;
<i>430</i>&nbsp;    @Override
<i>431</i>&nbsp;    public void endAnimation(ViewHolder item) {
<b class="nc"><i>432</i>&nbsp;        final View view = item.itemView;</b>
<i>433</i>&nbsp;        // this will trigger end callback which should set properties to their target values.
<b class="nc"><i>434</i>&nbsp;        view.animate().cancel();</b>
<i>435</i>&nbsp;        // TODO if some other animations are chained to end, how do we cancel them as well?
<b class="nc"><i>436</i>&nbsp;        for (int i = mPendingMoves.size() - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>437</i>&nbsp;            MoveInfo moveInfo = mPendingMoves.get(i);</b>
<b class="nc"><i>438</i>&nbsp;            if (moveInfo.holder == item) {</b>
<b class="nc"><i>439</i>&nbsp;                view.setTranslationY(0);</b>
<b class="nc"><i>440</i>&nbsp;                view.setTranslationX(0);</b>
<b class="nc"><i>441</i>&nbsp;                dispatchMoveFinished(item);</b>
<b class="nc"><i>442</i>&nbsp;                mPendingMoves.remove(i);</b>
<i>443</i>&nbsp;            }
<i>444</i>&nbsp;        }
<b class="nc"><i>445</i>&nbsp;        endChangeAnimation(mPendingChanges, item);</b>
<b class="nc"><i>446</i>&nbsp;        if (mPendingRemovals.remove(item)) {</b>
<b class="nc"><i>447</i>&nbsp;            view.setAlpha(1);</b>
<b class="nc"><i>448</i>&nbsp;            view.setTranslationY(0);</b>
<b class="nc"><i>449</i>&nbsp;            dispatchRemoveFinished(item);</b>
<i>450</i>&nbsp;        }
<b class="nc"><i>451</i>&nbsp;        if (mPendingAdditions.remove(item)) {</b>
<b class="nc"><i>452</i>&nbsp;            view.setAlpha(1);</b>
<b class="nc"><i>453</i>&nbsp;            view.setTranslationY(0);</b>
<b class="nc"><i>454</i>&nbsp;            dispatchAddFinished(item);</b>
<i>455</i>&nbsp;        }
<i>456</i>&nbsp;
<b class="nc"><i>457</i>&nbsp;        for (int i = mChangesList.size() - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>458</i>&nbsp;            ArrayList&lt;ChangeInfo&gt; changes = mChangesList.get(i);</b>
<b class="nc"><i>459</i>&nbsp;            endChangeAnimation(changes, item);</b>
<b class="nc"><i>460</i>&nbsp;            if (changes.isEmpty()) {</b>
<b class="nc"><i>461</i>&nbsp;                mChangesList.remove(i);</b>
<i>462</i>&nbsp;            }
<i>463</i>&nbsp;        }
<b class="nc"><i>464</i>&nbsp;        for (int i = mMovesList.size() - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>465</i>&nbsp;            ArrayList&lt;MoveInfo&gt; moves = mMovesList.get(i);</b>
<b class="nc"><i>466</i>&nbsp;            for (int j = moves.size() - 1; j &gt;= 0; j--) {</b>
<b class="nc"><i>467</i>&nbsp;                MoveInfo moveInfo = moves.get(j);</b>
<b class="nc"><i>468</i>&nbsp;                if (moveInfo.holder == item) {</b>
<b class="nc"><i>469</i>&nbsp;                    view.setTranslationY(0);</b>
<b class="nc"><i>470</i>&nbsp;                    view.setTranslationX(0);</b>
<b class="nc"><i>471</i>&nbsp;                    dispatchMoveFinished(item);</b>
<b class="nc"><i>472</i>&nbsp;                    moves.remove(j);</b>
<b class="nc"><i>473</i>&nbsp;                    if (moves.isEmpty()) {</b>
<b class="nc"><i>474</i>&nbsp;                        mMovesList.remove(i);</b>
<i>475</i>&nbsp;                    }
<i>476</i>&nbsp;                    break;
<i>477</i>&nbsp;                }
<i>478</i>&nbsp;            }
<i>479</i>&nbsp;        }
<b class="nc"><i>480</i>&nbsp;        for (int i = mAdditionsList.size() - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>481</i>&nbsp;            ArrayList&lt;ViewHolder&gt; additions = mAdditionsList.get(i);</b>
<b class="nc"><i>482</i>&nbsp;            if (additions.remove(item)) {</b>
<b class="nc"><i>483</i>&nbsp;                view.setAlpha(1);</b>
<b class="nc"><i>484</i>&nbsp;                view.setTranslationY(0);</b>
<b class="nc"><i>485</i>&nbsp;                dispatchAddFinished(item);</b>
<b class="nc"><i>486</i>&nbsp;                if (additions.isEmpty()) {</b>
<b class="nc"><i>487</i>&nbsp;                    mAdditionsList.remove(i);</b>
<i>488</i>&nbsp;                }
<i>489</i>&nbsp;            }
<i>490</i>&nbsp;        }
<i>491</i>&nbsp;
<i>492</i>&nbsp;        // animations should be ended by the cancel above.
<i>493</i>&nbsp;        //noinspection PointlessBooleanExpression,ConstantConditions
<b class="nc"><i>494</i>&nbsp;        if (mRemoveAnimations.remove(item) &amp;&amp; DEBUG) {</b>
<i>495</i>&nbsp;            throw new IllegalStateException(&quot;after animation is cancelled, item should not be in &quot;
<i>496</i>&nbsp;                    + &quot;mRemoveAnimations list&quot;);
<i>497</i>&nbsp;        }
<i>498</i>&nbsp;
<i>499</i>&nbsp;        //noinspection PointlessBooleanExpression,ConstantConditions
<b class="nc"><i>500</i>&nbsp;        if (mAddAnimations.remove(item) &amp;&amp; DEBUG) {</b>
<i>501</i>&nbsp;            throw new IllegalStateException(&quot;after animation is cancelled, item should not be in &quot;
<i>502</i>&nbsp;                    + &quot;mAddAnimations list&quot;);
<i>503</i>&nbsp;        }
<i>504</i>&nbsp;
<i>505</i>&nbsp;        //noinspection PointlessBooleanExpression,ConstantConditions
<b class="nc"><i>506</i>&nbsp;        if (mChangeAnimations.remove(item) &amp;&amp; DEBUG) {</b>
<i>507</i>&nbsp;            throw new IllegalStateException(&quot;after animation is cancelled, item should not be in &quot;
<i>508</i>&nbsp;                    + &quot;mChangeAnimations list&quot;);
<i>509</i>&nbsp;        }
<i>510</i>&nbsp;
<i>511</i>&nbsp;        //noinspection PointlessBooleanExpression,ConstantConditions
<b class="nc"><i>512</i>&nbsp;        if (mMoveAnimations.remove(item) &amp;&amp; DEBUG) {</b>
<i>513</i>&nbsp;            throw new IllegalStateException(&quot;after animation is cancelled, item should not be in &quot;
<i>514</i>&nbsp;                    + &quot;mMoveAnimations list&quot;);
<i>515</i>&nbsp;        }
<b class="nc"><i>516</i>&nbsp;        dispatchFinishedWhenDone();</b>
<i>517</i>&nbsp;    }
<i>518</i>&nbsp;
<i>519</i>&nbsp;    private void resetAnimation(ViewHolder holder) {
<b class="nc"><i>520</i>&nbsp;        if (DEFAULT_INTERPOLATOR == null) {</b>
<b class="nc"><i>521</i>&nbsp;            DEFAULT_INTERPOLATOR = new ValueAnimator().getInterpolator();</b>
<i>522</i>&nbsp;        }
<b class="nc"><i>523</i>&nbsp;        holder.itemView.animate().setInterpolator(DEFAULT_INTERPOLATOR);</b>
<b class="nc"><i>524</i>&nbsp;        endAnimation(holder);</b>
<i>525</i>&nbsp;    }
<i>526</i>&nbsp;
<i>527</i>&nbsp;    @Override
<i>528</i>&nbsp;    public boolean isRunning() {
<b class="nc"><i>529</i>&nbsp;        return (!mPendingAdditions.isEmpty()</b>
<b class="nc"><i>530</i>&nbsp;                || !mPendingChanges.isEmpty()</b>
<b class="nc"><i>531</i>&nbsp;                || !mPendingMoves.isEmpty()</b>
<b class="nc"><i>532</i>&nbsp;                || !mPendingRemovals.isEmpty()</b>
<b class="nc"><i>533</i>&nbsp;                || !mMoveAnimations.isEmpty()</b>
<b class="nc"><i>534</i>&nbsp;                || !mRemoveAnimations.isEmpty()</b>
<b class="nc"><i>535</i>&nbsp;                || !mAddAnimations.isEmpty()</b>
<b class="nc"><i>536</i>&nbsp;                || !mChangeAnimations.isEmpty()</b>
<b class="nc"><i>537</i>&nbsp;                || !mMovesList.isEmpty()</b>
<b class="nc"><i>538</i>&nbsp;                || !mAdditionsList.isEmpty()</b>
<b class="nc"><i>539</i>&nbsp;                || !mChangesList.isEmpty());</b>
<i>540</i>&nbsp;    }
<i>541</i>&nbsp;
<i>542</i>&nbsp;    /**
<i>543</i>&nbsp;     * Check the state of currently pending and running animations. If there are none
<i>544</i>&nbsp;     * pending/running, call {@link #dispatchAnimationsFinished()} to notify any
<i>545</i>&nbsp;     * listeners.
<i>546</i>&nbsp;     */
<i>547</i>&nbsp;    void dispatchFinishedWhenDone() {
<b class="nc"><i>548</i>&nbsp;        if (!isRunning()) {</b>
<b class="nc"><i>549</i>&nbsp;            dispatchAnimationsFinished();</b>
<i>550</i>&nbsp;        }
<i>551</i>&nbsp;    }
<i>552</i>&nbsp;
<i>553</i>&nbsp;    @Override
<i>554</i>&nbsp;    public void endAnimations() {
<b class="nc"><i>555</i>&nbsp;        int count = mPendingMoves.size();</b>
<b class="nc"><i>556</i>&nbsp;        for (int i = count - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>557</i>&nbsp;            MoveInfo item = mPendingMoves.get(i);</b>
<b class="nc"><i>558</i>&nbsp;            View view = item.holder.itemView;</b>
<b class="nc"><i>559</i>&nbsp;            view.setTranslationY(0);</b>
<b class="nc"><i>560</i>&nbsp;            view.setTranslationX(0);</b>
<b class="nc"><i>561</i>&nbsp;            dispatchMoveFinished(item.holder);</b>
<b class="nc"><i>562</i>&nbsp;            mPendingMoves.remove(i);</b>
<i>563</i>&nbsp;        }
<b class="nc"><i>564</i>&nbsp;        count = mPendingRemovals.size();</b>
<b class="nc"><i>565</i>&nbsp;        for (int i = count - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>566</i>&nbsp;            ViewHolder item = mPendingRemovals.get(i);</b>
<b class="nc"><i>567</i>&nbsp;            dispatchRemoveFinished(item);</b>
<b class="nc"><i>568</i>&nbsp;            mPendingRemovals.remove(i);</b>
<i>569</i>&nbsp;        }
<b class="nc"><i>570</i>&nbsp;        count = mPendingAdditions.size();</b>
<b class="nc"><i>571</i>&nbsp;        for (int i = count - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>572</i>&nbsp;            ViewHolder item = mPendingAdditions.get(i);</b>
<b class="nc"><i>573</i>&nbsp;            item.itemView.setAlpha(1);</b>
<b class="nc"><i>574</i>&nbsp;            item.itemView.setTranslationY(0);</b>
<b class="nc"><i>575</i>&nbsp;            dispatchAddFinished(item);</b>
<b class="nc"><i>576</i>&nbsp;            mPendingAdditions.remove(i);</b>
<i>577</i>&nbsp;        }
<b class="nc"><i>578</i>&nbsp;        count = mPendingChanges.size();</b>
<b class="nc"><i>579</i>&nbsp;        for (int i = count - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>580</i>&nbsp;            endChangeAnimationIfNecessary(mPendingChanges.get(i));</b>
<i>581</i>&nbsp;        }
<b class="nc"><i>582</i>&nbsp;        mPendingChanges.clear();</b>
<b class="nc"><i>583</i>&nbsp;        if (!isRunning()) {</b>
<i>584</i>&nbsp;            return;
<i>585</i>&nbsp;        }
<i>586</i>&nbsp;
<b class="nc"><i>587</i>&nbsp;        int listCount = mMovesList.size();</b>
<b class="nc"><i>588</i>&nbsp;        for (int i = listCount - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>589</i>&nbsp;            ArrayList&lt;MoveInfo&gt; moves = mMovesList.get(i);</b>
<b class="nc"><i>590</i>&nbsp;            count = moves.size();</b>
<b class="nc"><i>591</i>&nbsp;            for (int j = count - 1; j &gt;= 0; j--) {</b>
<b class="nc"><i>592</i>&nbsp;                MoveInfo moveInfo = moves.get(j);</b>
<b class="nc"><i>593</i>&nbsp;                ViewHolder item = moveInfo.holder;</b>
<b class="nc"><i>594</i>&nbsp;                View view = item.itemView;</b>
<b class="nc"><i>595</i>&nbsp;                view.setTranslationY(0);</b>
<b class="nc"><i>596</i>&nbsp;                view.setTranslationX(0);</b>
<b class="nc"><i>597</i>&nbsp;                dispatchMoveFinished(moveInfo.holder);</b>
<b class="nc"><i>598</i>&nbsp;                moves.remove(j);</b>
<b class="nc"><i>599</i>&nbsp;                if (moves.isEmpty()) {</b>
<b class="nc"><i>600</i>&nbsp;                    mMovesList.remove(moves);</b>
<i>601</i>&nbsp;                }
<i>602</i>&nbsp;            }
<i>603</i>&nbsp;        }
<b class="nc"><i>604</i>&nbsp;        listCount = mAdditionsList.size();</b>
<b class="nc"><i>605</i>&nbsp;        for (int i = listCount - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>606</i>&nbsp;            ArrayList&lt;ViewHolder&gt; additions = mAdditionsList.get(i);</b>
<b class="nc"><i>607</i>&nbsp;            count = additions.size();</b>
<b class="nc"><i>608</i>&nbsp;            for (int j = count - 1; j &gt;= 0; j--) {</b>
<b class="nc"><i>609</i>&nbsp;                ViewHolder item = additions.get(j);</b>
<b class="nc"><i>610</i>&nbsp;                View view = item.itemView;</b>
<b class="nc"><i>611</i>&nbsp;                view.setAlpha(1);</b>
<b class="nc"><i>612</i>&nbsp;                view.setTranslationY(0);</b>
<b class="nc"><i>613</i>&nbsp;                dispatchAddFinished(item);</b>
<b class="nc"><i>614</i>&nbsp;                additions.remove(j);</b>
<b class="nc"><i>615</i>&nbsp;                if (additions.isEmpty()) {</b>
<b class="nc"><i>616</i>&nbsp;                    mAdditionsList.remove(additions);</b>
<i>617</i>&nbsp;                }
<i>618</i>&nbsp;            }
<i>619</i>&nbsp;        }
<b class="nc"><i>620</i>&nbsp;        listCount = mChangesList.size();</b>
<b class="nc"><i>621</i>&nbsp;        for (int i = listCount - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>622</i>&nbsp;            ArrayList&lt;ChangeInfo&gt; changes = mChangesList.get(i);</b>
<b class="nc"><i>623</i>&nbsp;            count = changes.size();</b>
<b class="nc"><i>624</i>&nbsp;            for (int j = count - 1; j &gt;= 0; j--) {</b>
<b class="nc"><i>625</i>&nbsp;                endChangeAnimationIfNecessary(changes.get(j));</b>
<b class="nc"><i>626</i>&nbsp;                if (changes.isEmpty()) {</b>
<b class="nc"><i>627</i>&nbsp;                    mChangesList.remove(changes);</b>
<i>628</i>&nbsp;                }
<i>629</i>&nbsp;            }
<i>630</i>&nbsp;        }
<i>631</i>&nbsp;
<b class="nc"><i>632</i>&nbsp;        cancelAll(mRemoveAnimations);</b>
<b class="nc"><i>633</i>&nbsp;        cancelAll(mMoveAnimations);</b>
<b class="nc"><i>634</i>&nbsp;        cancelAll(mAddAnimations);</b>
<b class="nc"><i>635</i>&nbsp;        cancelAll(mChangeAnimations);</b>
<i>636</i>&nbsp;
<b class="nc"><i>637</i>&nbsp;        dispatchAnimationsFinished();</b>
<i>638</i>&nbsp;    }
<i>639</i>&nbsp;
<i>640</i>&nbsp;    void cancelAll(List&lt;ViewHolder&gt; viewHolders) {
<b class="nc"><i>641</i>&nbsp;        for (int i = viewHolders.size() - 1; i &gt;= 0; i--) {</b>
<b class="nc"><i>642</i>&nbsp;            viewHolders.get(i).itemView.animate().cancel();</b>
<i>643</i>&nbsp;        }
<i>644</i>&nbsp;    }
<i>645</i>&nbsp;
<i>646</i>&nbsp;    /**
<i>647</i>&nbsp;     * {@inheritDoc}
<i>648</i>&nbsp;     * &lt;p&gt;
<i>649</i>&nbsp;     * If the payload list is not empty, DefaultItemAnimator returns &lt;code&gt;true&lt;/code&gt;.
<i>650</i>&nbsp;     * When this is the case:
<i>651</i>&nbsp;     * &lt;ul&gt;
<i>652</i>&nbsp;     * &lt;li&gt;If you override {@link #animateChange(ViewHolder, ViewHolder, int, int, int, int)}, both
<i>653</i>&nbsp;     * ViewHolder arguments will be the same instance.
<i>654</i>&nbsp;     * &lt;/li&gt;
<i>655</i>&nbsp;     * &lt;li&gt;
<i>656</i>&nbsp;     * If you are not overriding {@link #animateChange(ViewHolder, ViewHolder, int, int, int, int)},
<i>657</i>&nbsp;     * then DefaultItemAnimator will call {@link #animateMove(ViewHolder, int, int, int, int)} and
<i>658</i>&nbsp;     * run a move animation instead.
<i>659</i>&nbsp;     * &lt;/li&gt;
<i>660</i>&nbsp;     * &lt;/ul&gt;
<i>661</i>&nbsp;     */
<i>662</i>&nbsp;    @Override
<i>663</i>&nbsp;    public boolean canReuseUpdatedViewHolder(@NonNull ViewHolder viewHolder,
<i>664</i>&nbsp;                                             @NonNull List&lt;Object&gt; payloads) {
<b class="nc"><i>665</i>&nbsp;        return !payloads.isEmpty() || super.canReuseUpdatedViewHolder(viewHolder, payloads);</b>
<i>666</i>&nbsp;    }
<i>667</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2018-05-09 20:15</div>
</div>
</body>
</html>
